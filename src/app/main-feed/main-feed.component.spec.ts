import { IPost } from 'src/app/shared/api/consolidated/models/posts.response-model';
import { ICard } from 'src/app/shared/api/consolidated/models/meta.response-model';
import { MainFeedComponent } from './main-feed.component';


import { MetaService } from '../shared/api/consolidated/meta.service';
import { PostsService } from '../shared/api/consolidated/posts.service';

describe('MainFeedComponent', () => {

  const component: MainFeedComponent =  new MainFeedComponent({} as PostsService, {} as MetaService);

  describe('_filterCards()', () => {

    it('should return empty array[]', () => {

      expect(component['_filterCards']([])).toEqual([])
    });

    it('should return array with only card types 0 and 2', () => {
      const unfilteredCardsArray: ICard[] = JSON.parse('[{"_id":"6040aa7040062c0024f96420","content":{"resultsUi":{"resultsTitle":"Thanks for responding!","resultsSubtitle":"Once the results are ready, we\'ll send them to your preferred email","resultsButtonText":"Change Contact Email","resultsButtonDeeplink":"fishbowl://"},"arrowEnabled":false,"titleColor":"#6240B8","backgroundColor":"#060217","textColor":"#F91414","answers":[],"showResults":true,"showHelpLink":false,"title":"New card EtniUpdate","text":"New card EtniUpdate"},"type":0,"position":3,"navigation":[]},{"_id":"60a4fe7640a003001e65de81","content":{"resultsUi":{"resultsTitle":"Thanks for responding!","resultsSubtitle":"Once the results are ready, we\'ll send them to your preferred email","resultsButtonText":"Change Contact Email","resultsButtonDeeplink":"fishbowl://"},"arrowEnabled":false,"titleColor":"#00FFF5","backgroundColor":"#4C28FF","textColor":"#FFFFFF","answers":[],"showResults":true,"showHelpLink":false,"title":"New card 777","text":"New card 777New card 777","imageUrl":"https://d2yhyolo2glazm.cloudfront.net/card_images/bdkt06XM3ekDH.jpg"},"type":1,"position":4,"navigation":[]},{"_id":"617be27e1ce4d6002ae9d16e","content":{"resultsUi":{"resultsTitle":"Thanks for responding!","resultsSubtitle":"Once the results are ready, we\'ll send them to your preferred email","resultsButtonText":"Change Contact Email","resultsButtonDeeplink":"fishbowl://"},"arrowEnabled":false,"titleColor":"#9d94ab","backgroundColor":"#4C28FF","textColor":"#544e5d","answers":[{"_id":"617be27e1ce4d6002ae9d16f","text":"pizza","color":"#FFFFFF","variant":0},{"_id":"617be27e1ce4d6002ae9d170","text":"pasta","color":"#FFFFFF","variant":1}],"showResults":true,"showHelpLink":false,"title":"Food Survey","text":"Pizza or pasta?"},"type":2,"position":7,"votedByCurrentUser":false,"answers":[],"navigation":[]},{"_id":"5f312537ac97d4001da0c4c0","content":{"resultsUi":{"resultsTitle":"Thanks for responding!","resultsSubtitle":"Once the results are ready, we\'ll send them to your preferred email","resultsButtonText":"Change Contact Email","resultsButtonDeeplink":"fishbowl://"},"arrowEnabled":false,"titleColor":"#F0A8C9","backgroundColor":"#CB0000","textColor":"#EAB3D8","answers":[],"showResults":true,"showHelpLink":false,"title":"Interesting Card","text":"Very interesting card"},"type":0,"position":17,"navigation":[]}]');
      const filteredArray: ICard[] = JSON.parse('[{"_id":"6040aa7040062c0024f96420","content":{"resultsUi":{"resultsTitle":"Thanks for responding!","resultsSubtitle":"Once the results are ready, we\'ll send them to your preferred email","resultsButtonText":"Change Contact Email","resultsButtonDeeplink":"fishbowl://"},"arrowEnabled":false,"titleColor":"#6240B8","backgroundColor":"#060217","textColor":"#F91414","answers":[],"showResults":true,"showHelpLink":false,"title":"New card EtniUpdate","text":"New card EtniUpdate"},"type":0,"position":3,"navigation":[]},{"_id":"617be27e1ce4d6002ae9d16e","content":{"resultsUi":{"resultsTitle":"Thanks for responding!","resultsSubtitle":"Once the results are ready, we\'ll send them to your preferred email","resultsButtonText":"Change Contact Email","resultsButtonDeeplink":"fishbowl://"},"arrowEnabled":false,"titleColor":"#9d94ab","backgroundColor":"#4C28FF","textColor":"#544e5d","answers":[{"_id":"617be27e1ce4d6002ae9d16f","text":"pizza","color":"#FFFFFF","variant":0},{"_id":"617be27e1ce4d6002ae9d170","text":"pasta","color":"#FFFFFF","variant":1}],"showResults":true,"showHelpLink":false,"title":"Food Survey","text":"Pizza or pasta?"},"type":2,"position":7,"votedByCurrentUser":false,"answers":[],"navigation":[]},{"_id":"5f312537ac97d4001da0c4c0","content":{"resultsUi":{"resultsTitle":"Thanks for responding!","resultsSubtitle":"Once the results are ready, we\'ll send them to your preferred email","resultsButtonText":"Change Contact Email","resultsButtonDeeplink":"fishbowl://"},"arrowEnabled":false,"titleColor":"#F0A8C9","backgroundColor":"#CB0000","textColor":"#EAB3D8","answers":[],"showResults":true,"showHelpLink":false,"title":"Interesting Card","text":"Very interesting card"},"type":0,"position":17,"navigation":[]}]');
      expect(component['_filterCards'](unfilteredCardsArray)).toEqual(filteredArray)
    });

    it('should return array with only lowest priority cards if any position properties are equal', () => {
      const unfilteredCards: ICard[] = JSON.parse('[{"_id":"6040aa7040062c0024f96420","content":{"resultsUi":{"resultsTitle":"Thanks for responding!","resultsSubtitle":"Once the results are ready, we\'ll send them to your preferred email","resultsButtonText":"Change Contact Email","resultsButtonDeeplink":"fishbowl://"},"arrowEnabled":false,"titleColor":"#6240B8","backgroundColor":"#060217","textColor":"#F91414","answers":[],"showResults":true,"showHelpLink":false,"title":"New card EtniUpdate","text":"New card EtniUpdate"},"type":0,"position":3,"navigation":[]},{"_id":"617be27e1ce4d6002ae9d16e","content":{"resultsUi":{"resultsTitle":"Thanks for responding!","resultsSubtitle":"Once the results are ready, we\'ll send them to your preferred email","resultsButtonText":"Change Contact Email","resultsButtonDeeplink":"fishbowl://"},"arrowEnabled":false,"titleColor":"#9d94ab","backgroundColor":"#4C28FF","textColor":"#544e5d","answers":[{"_id":"617be27e1ce4d6002ae9d16f","text":"pizza","color":"#FFFFFF","variant":0},{"_id":"617be27e1ce4d6002ae9d170","text":"pasta","color":"#FFFFFF","variant":1}],"showResults":true,"showHelpLink":false,"title":"Food Survey","text":"Pizza or pasta?"},"type":2,"position":7,"votedByCurrentUser":false,"answers":[],"navigation":[]},{"_id":"5f312537ac97d4001da0c4c0","content":{"resultsUi":{"resultsTitle":"Thanks for responding!","resultsSubtitle":"Once the results are ready, we\'ll send them to your preferred email","resultsButtonText":"Change Contact Email","resultsButtonDeeplink":"fishbowl://"},"arrowEnabled":false,"titleColor":"#F0A8C9","backgroundColor":"#CB0000","textColor":"#EAB3D8","answers":[],"showResults":true,"showHelpLink":false,"title":"Interesting Card","text":"Very interesting card"},"type":0,"position":17,"navigation":[]},{"_id":"6040aa7040062c0024f96420","content":{"resultsUi":{"resultsTitle":"Thanks for responding!","resultsSubtitle":"Once the results are ready, we\'ll send them to your preferred email","resultsButtonText":"Change Contact Email","resultsButtonDeeplink":"fishbowl://"},"arrowEnabled":false,"titleColor":"#6240B8","backgroundColor":"#060217","textColor":"#F91414","answers":[],"showResults":true,"showHelpLink":false,"title":"New card EtniUpdate","text":"New card EtniUpdate"},"type":0,"position":3,"navigation":[]},{"_id":"617be27e1ce4d6002ae9d16e","content":{"resultsUi":{"resultsTitle":"Thanks for responding!","resultsSubtitle":"Once the results are ready, we\'ll send them to your preferred email","resultsButtonText":"Change Contact Email","resultsButtonDeeplink":"fishbowl://"},"arrowEnabled":false,"titleColor":"#9d94ab","backgroundColor":"#4C28FF","textColor":"#544e5d","answers":[{"_id":"617be27e1ce4d6002ae9d16f","text":"pizza","color":"#FFFFFF","variant":0},{"_id":"617be27e1ce4d6002ae9d170","text":"pasta","color":"#FFFFFF","variant":1}],"showResults":true,"showHelpLink":false,"title":"Food Survey","text":"Pizza or pasta?"},"type":2,"position":7,"votedByCurrentUser":false,"answers":[],"navigation":[]},{"_id":"5f312537ac97d4001da0c4c0","content":{"resultsUi":{"resultsTitle":"Thanks for responding!","resultsSubtitle":"Once the results are ready, we\'ll send them to your preferred email","resultsButtonText":"Change Contact Email","resultsButtonDeeplink":"fishbowl://"},"arrowEnabled":false,"titleColor":"#F0A8C9","backgroundColor":"#CB0000","textColor":"#EAB3D8","answers":[],"showResults":true,"showHelpLink":false,"title":"Interesting Card","text":"Very interesting card"},"type":0,"position":17,"navigation":[]}]');
      const filteredArray: ICard[] = JSON.parse('[{"_id":"6040aa7040062c0024f96420","content":{"resultsUi":{"resultsTitle":"Thanks for responding!","resultsSubtitle":"Once the results are ready, we\'ll send them to your preferred email","resultsButtonText":"Change Contact Email","resultsButtonDeeplink":"fishbowl://"},"arrowEnabled":false,"titleColor":"#6240B8","backgroundColor":"#060217","textColor":"#F91414","answers":[],"showResults":true,"showHelpLink":false,"title":"New card EtniUpdate","text":"New card EtniUpdate"},"type":0,"position":3,"navigation":[]},{"_id":"617be27e1ce4d6002ae9d16e","content":{"resultsUi":{"resultsTitle":"Thanks for responding!","resultsSubtitle":"Once the results are ready, we\'ll send them to your preferred email","resultsButtonText":"Change Contact Email","resultsButtonDeeplink":"fishbowl://"},"arrowEnabled":false,"titleColor":"#9d94ab","backgroundColor":"#4C28FF","textColor":"#544e5d","answers":[{"_id":"617be27e1ce4d6002ae9d16f","text":"pizza","color":"#FFFFFF","variant":0},{"_id":"617be27e1ce4d6002ae9d170","text":"pasta","color":"#FFFFFF","variant":1}],"showResults":true,"showHelpLink":false,"title":"Food Survey","text":"Pizza or pasta?"},"type":2,"position":7,"votedByCurrentUser":false,"answers":[],"navigation":[]},{"_id":"5f312537ac97d4001da0c4c0","content":{"resultsUi":{"resultsTitle":"Thanks for responding!","resultsSubtitle":"Once the results are ready, we\'ll send them to your preferred email","resultsButtonText":"Change Contact Email","resultsButtonDeeplink":"fishbowl://"},"arrowEnabled":false,"titleColor":"#F0A8C9","backgroundColor":"#CB0000","textColor":"#EAB3D8","answers":[],"showResults":true,"showHelpLink":false,"title":"Interesting Card","text":"Very interesting card"},"type":0,"position":17,"navigation":[]}]');
      expect(component['_filterCards'](unfilteredCards)).toEqual(filteredArray)
    });
  });

  describe('_mixCardsWithPosts()', () => {

    it('should return empty array[]', () => {

      expect(component['_mixCardsWithPosts']([], [])).toEqual([])
    });

    it('should return array of cards mixed with posts', () => {

      const cards: ICard[] = JSON.parse('[{"_id":"6040aa7040062c0024f96420","content":{"resultsUi":{"resultsTitle":"Thanks for responding!","resultsSubtitle":"Once the results are ready, we\'ll send them to your preferred email","resultsButtonText":"Change Contact Email","resultsButtonDeeplink":"fishbowl://"},"arrowEnabled":false,"titleColor":"#6240B8","backgroundColor":"#060217","textColor":"#F91414","answers":[],"showResults":true,"showHelpLink":false,"title":"New card EtniUpdate","text":"New card EtniUpdate"},"type":0,"position":3,"navigation":[]},{"_id":"617be27e1ce4d6002ae9d16e","content":{"resultsUi":{"resultsTitle":"Thanks for responding!","resultsSubtitle":"Once the results are ready, we\'ll send them to your preferred email","resultsButtonText":"Change Contact Email","resultsButtonDeeplink":"fishbowl://"},"arrowEnabled":false,"titleColor":"#9d94ab","backgroundColor":"#4C28FF","textColor":"#544e5d","answers":[{"_id":"617be27e1ce4d6002ae9d16f","text":"pizza","color":"#FFFFFF","variant":0},{"_id":"617be27e1ce4d6002ae9d170","text":"pasta","color":"#FFFFFF","variant":1}],"showResults":true,"showHelpLink":false,"title":"Food Survey","text":"Pizza or pasta?"},"type":2,"position":7,"votedByCurrentUser":false,"answers":[],"navigation":[]},{"_id":"5f312537ac97d4001da0c4c0","content":{"resultsUi":{"resultsTitle":"Thanks for responding!","resultsSubtitle":"Once the results are ready, we\'ll send them to your preferred email","resultsButtonText":"Change Contact Email","resultsButtonDeeplink":"fishbowl://"},"arrowEnabled":false,"titleColor":"#F0A8C9","backgroundColor":"#CB0000","textColor":"#EAB3D8","answers":[],"showResults":true,"showHelpLink":false,"title":"Interesting Card","text":"Very interesting card"},"type":0,"position":17,"navigation":[]}]');
      const posts: IPost[] = JSON.parse('[{"_id":"61852f1e17c921002a45d164","reactionCounters":{"like":1,"helpful":0,"smart":0,"funny":0,"uplifting":0},"reactionCountersIncludingComments":{"like":1,"helpful":0,"smart":0,"funny":0,"uplifting":0},"sign":{"companyDisplayName":"Kk kompany limited","signType":0,"userColor":"999999","signAccent":0},"likesCount":1,"likesCountIncludingComments":1,"commentsCount":0,"federationPoints":1636118422,"messageType":0,"sharesCount":0,"bowlMemberBadges":[0],"contentFederationMode":0,"feedId":"5f2910512d5ef4001d23f70e","postedCompanyAlias":{"aliasId":"5f3b8bc3bc1bc700040b94e6","aliasName":"Kk kompany limited"},"feedType":2,"division":"Analytics","text":"https://joinfishbowl.com/live_w22yw5nau6","messageData":{"text":"https://joinfishbowl.com/live_w22yw5nau6","linkMetadata":null},"handleUrl":"38Y9qA3uXkjoX","tags":[],"userDefinedMentions":[],"likes":[],"date":"2021-11-05T13:18:22.235Z","feedName":"THIS IS STAGE","feedIcon":"https://d2yhyolo2glazm.cloudfront.net/crowd_images/5AX3xefeDQHSX.png","feedHandleUrl":"this-is-stage","publicFeed":true,"feedBackground":{"from":"A46600","to":"D16500"},"feedFishIconColor":"6b0b0b","inBookmarks":false,"canBeEmbedded":true,"canJoinBowl":true}]');
      const successMixedCardsWithPosts: Array<ICard | IPost> =  JSON.parse('[{"_id":"61852f1e17c921002a45d164","reactionCounters":{"like":1,"helpful":0,"smart":0,"funny":0,"uplifting":0},"reactionCountersIncludingComments":{"like":1,"helpful":0,"smart":0,"funny":0,"uplifting":0},"sign":{"companyDisplayName":"Kk kompany limited","signType":0,"userColor":"999999","signAccent":0},"likesCount":1,"likesCountIncludingComments":1,"commentsCount":0,"federationPoints":1636118422,"messageType":0,"sharesCount":0,"bowlMemberBadges":[0],"contentFederationMode":0,"feedId":"5f2910512d5ef4001d23f70e","postedCompanyAlias":{"aliasId":"5f3b8bc3bc1bc700040b94e6","aliasName":"Kk kompany limited"},"feedType":2,"division":"Analytics","text":"https://joinfishbowl.com/live_w22yw5nau6","messageData":{"text":"https://joinfishbowl.com/live_w22yw5nau6","linkMetadata":null},"handleUrl":"38Y9qA3uXkjoX","tags":[],"userDefinedMentions":[],"likes":[],"date":"2021-11-05T13:18:22.235Z","feedName":"THIS IS STAGE","feedIcon":"https://d2yhyolo2glazm.cloudfront.net/crowd_images/5AX3xefeDQHSX.png","feedHandleUrl":"this-is-stage","publicFeed":true,"feedBackground":{"from":"A46600","to":"D16500"},"feedFishIconColor":"6b0b0b","inBookmarks":false,"canBeEmbedded":true,"canJoinBowl":true}]')

      expect(component['_mixCardsWithPosts'](cards, posts)).toEqual(successMixedCardsWithPosts)
    });

  });

});
